<script>
(function(){
  const el = id => document.getElementById(id);
  const addMinutes = (base,m) => new Date(base.getTime()+m*60000);
  const fmt12 = d => { let h=d.getHours(), m=d.getMinutes(); const ampm=h>=12?'PM':'AM'; h=h%12; if(h===0)h=12; return `${h}:${String(m).padStart(2,'0')} ${ampm}`; };

  // Use jsPDF to generate a styled PDF
  async function downloadTimelinePDF(){
    const { jsPDF } = window.jspdf || await import('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');

    const tlList = document.querySelectorAll('#tlList .tl-item');
    if(!tlList.length){ alert('Please generate a timeline first.'); return; }

    const pdf = new jsPDF({orientation:'portrait', unit:'pt', format:'letter'});
    const brandColor = '#9a633e';

    // Title
    pdf.setFont('helvetica','bold');
    pdf.setFontSize(18);
    pdf.setTextColor(brandColor);
    pdf.text('Rule Creative Co. – Wedding Timeline', 40, 60);

    // Body
    pdf.setFontSize(12);
    pdf.setTextColor('#000');
    let y = 90;

    let currentSection = '';
    tlList.forEach(item => {
      if(item.classList.contains('tl-section')){
        currentSection = item.textContent.trim();
        pdf.setFont('times','bold');
        pdf.setFontSize(14);
        pdf.setTextColor(brandColor);
        y += 25;
        pdf.text(currentSection, 40, y);
        y += 10;
        pdf.setDrawColor(brandColor);
        pdf.line(40, y, 550, y);
        y += 20;
      } else {
        const time = item.querySelector('.time')?.textContent.trim() || '';
        const desc = item.querySelector('strong')?.textContent.trim() || '';
        pdf.setFont('helvetica','normal');
        pdf.setFontSize(11);
        pdf.setTextColor('#000');
        pdf.text(`${time}   ${desc}`, 50, y);
        y += 18;
        if(y > 740){ pdf.addPage(); y = 60; }
      }
    });

    // Styled, clickable footer on every page
    const pageCount = pdf.getNumberOfPages();
    for(let i=1; i<=pageCount; i++){
      pdf.setPage(i);
      const baseY = 770;
      pdf.setFont('helvetica','italic');
      pdf.setFontSize(10);
      pdf.setTextColor(brandColor);
      pdf.text('Have questions or need help customizing your wedding day timeline? I’d love to help!', 40, baseY);
      // Clickable email link
      pdf.setFont('helvetica','bold');
      pdf.setFontSize(10);
      pdf.setTextColor(brandColor);
      // Use textWithLink for a proper clickable mailto link
      pdf.textWithLink('hello@rulecreativeco.com', 40, baseY + 14, { url: 'mailto:hello@rulecreativeco.com' });
    }

    pdf.save('wedding-timeline.pdf');
  }

  document.addEventListener('DOMContentLoaded',()=>{
    const gen = document.getElementById('gen');
    const pdfBtn = document.getElementById('pdf');
    if(gen) gen.onclick = buildTimeline;
    if(pdfBtn) pdfBtn.onclick = downloadTimelinePDF;
  });
})();
</script>('DOMContentLoaded',()=>{
    const gen = document.getElementById('gen');
    const pdf = document.getElementById('pdf');
    if(gen) gen.onclick = buildTimeline;
    if(pdf) pdf.onclick = downloadTimelinePDF;
  });
})();
</script>
